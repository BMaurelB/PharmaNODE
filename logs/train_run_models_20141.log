/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/io/image.py:14: UserWarning: Failed to load image Python extension: 'dlopen(/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/image.so, 0x0006): Library not loaded: @rpath/libjpeg.9.dylib
  Referenced from: <367D4265-B20F-34BD-94EB-4F3EE47C385B> /opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/image.so
  Reason: tried: '/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/../../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/../../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/lib/python3.12/lib-dynload/../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/bin/../lib/libjpeg.9.dylib' (no such file)'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/run_models.py
run_models.py --niters 5000 -n 200 -s 40 -l 10 --dataset PK_Tacro --latent-ode --noise-weight 0.01 --max-t 5. --seed 1 --experiment 20141
Experiment 20141
Epoch 0010 [Test seq (cond on sampled tp)] | Loss 3738.510254 | Likelihood -3935.078857 | KL fp 1.5283 | FP STD 0.5416|
KL coef: 0.0
Train loss (one batch): 5461.2412109375
Train CE loss (one batch): 0.0
Test MSE (raw): 0.7878
Test MSE (smoothed with alpha=0.01): 0.7878
New best smoothed test MSE: 0.7878. Saving best model to experiments/experiment_20141_best.ckpt
Test MSE group_0: 0.9897
Test MSE group_1: 0.6708
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: 1.3190
train MSE group_1: 0.9154
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Experiment 20141
Epoch 0020 [Test seq (cond on sampled tp)] | Loss 1091.615845 | Likelihood -1135.833740 | KL fp 5.6577 | FP STD 0.3379|
KL coef: 0.09561792499119559
Train loss (one batch): 1525.673828125
Train CE loss (one batch): 0.0
Test MSE (raw): 0.2279
Test MSE (smoothed with alpha=0.01): 0.7822
New best smoothed test MSE: 0.7822. Saving best model to experiments/experiment_20141_best.ckpt
Test MSE group_0: 0.1744
Test MSE group_1: 0.2589
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: 0.1725
train MSE group_1: 0.4178
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Experiment 20141
Epoch 0030 [Test seq (cond on sampled tp)] | Loss 745.392273 | Likelihood -788.193787 | KL fp 4.2900 | FP STD 0.3048|
KL coef: 0.18209306240276923
Train loss (one batch): 1046.5010986328125
Train CE loss (one batch): 0.0
Test MSE (raw): 0.1584
Test MSE (smoothed with alpha=0.01): 0.7759
New best smoothed test MSE: 0.7759. Saving best model to experiments/experiment_20141_best.ckpt
Test MSE group_0: 0.1820
Test MSE group_1: 0.1447
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: 0.2033
train MSE group_1: 0.2192
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Couldn't import umap
Sampling dataset of 200 training examples
############## ['164', '166', '167', '168', '170', '171', '172', '173', '175', '176', '178', '179', '180', '181', '182', '184', '185', '186', '187', '188', '191', '192', '193', '194', '195', '196', '197', '198', '199', '200']
150
TensorBoard logs will be saved to: experiments/runs/20141
Traceback (most recent call last):
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/run_models.py", line 288, in <module>
    train_res = model.compute_all_losses(batch_dict, n_traj_samples = 3, kl_coef = kl_coef)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/base_models.py", line 261, in compute_all_losses
    pred_y, info = self.get_reconstruction(batch_dict["tp_to_predict"], 
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/latent_ode.py", line 98, in get_reconstruction
    sol_y = self.diffeq_solver(first_point_enc_aug, time_steps_to_predict)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/diffeq_solver.py", line 40, in forward
    pred_y = odeint(self.ode_func, first_point, time_steps_to_predict, 
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/odeint.py", line 80, in odeint
    solution = solver.integrate(t)
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/solvers.py", line 34, in integrate
    solution[i] = self._advance(t[i])
                  ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 246, in _advance
    self.rk_state = self._adaptive_step(self.rk_state)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 311, in _adaptive_step
    y1, f1, y1_error, k = _runge_kutta_step(self.func, y0, f0, t0, dt, t1, tableau=self.tableau)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 77, in _runge_kutta_step
    yi = y0 + torch.sum(k[..., :i + 1] * (beta_i * dt), dim=-1).view_as(f0)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
