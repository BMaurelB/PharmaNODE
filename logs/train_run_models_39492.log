/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/io/image.py:14: UserWarning: Failed to load image Python extension: 'dlopen(/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/image.so, 0x0006): Library not loaded: @rpath/libjpeg.9.dylib
  Referenced from: <367D4265-B20F-34BD-94EB-4F3EE47C385B> /opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/image.so
  Reason: tried: '/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/../../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchvision/../../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/lib/python3.12/lib-dynload/../../libjpeg.9.dylib' (no such file), '/opt/miniconda3/envs/NODE_test/bin/../lib/libjpeg.9.dylib' (no such file)'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/read_tacro.py:109: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df = df.applymap(lambda x: str(x).replace(",", ".") if isinstance(x, str) else x)
/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/read_tacro.py:109: FutureWarning: DataFrame.applymap has been deprecated. Use DataFrame.map instead.
  df = df.applymap(lambda x: str(x).replace(",", ".") if isinstance(x, str) else x)
/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/plotting.py:295: UserWarning: FigureCanvasAgg is non-interactive, and thus cannot be shown
  plt.show(block=False)
/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/run_models.py
run_models.py --niters 50000 -n 200 -s 40 -l 10 --dataset PK_Tacro --latent-ode --viz --noise-weight 0.01 --max-t 5. --seed 50 --experiment 39492
Experiment 39492
Epoch 0020 [Test seq (cond on sampled tp)] | Loss 64.192558 | Likelihood -69.778076 | KL fp 2.4450 | FP STD 0.1009|
KL coef: 0.09561792499119559
Train loss (one batch): 48.602176666259766
Train CE loss (one batch): 0.0
Test MSE (raw): 0.0147
Test MSE (smoothed with alpha=0.01): 0.0147
New best smoothed test MSE: 0.0147. Saving best model to experiments/experiment_39492_best.ckpt
Test MSE group_0: nan
Test MSE group_1: 0.0147
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: nan
train MSE group_1: 0.0107
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Experiment 39492
Epoch 0040 [Test seq (cond on sampled tp)] | Loss 29.728861 | Likelihood -30.281961 | KL fp 3.0795 | FP STD 0.0586|
KL coef: 0.2602996266117198
Train loss (one batch): 29.39021110534668
Train CE loss (one batch): 0.0
Test MSE (raw): 0.0068
Test MSE (smoothed with alpha=0.01): 0.0146
New best smoothed test MSE: 0.0146. Saving best model to experiments/experiment_39492_best.ckpt
Test MSE group_0: nan
Test MSE group_1: 0.0068
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: nan
train MSE group_1: 0.0067
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Experiment 39492
Epoch 0060 [Test seq (cond on sampled tp)] | Loss 31.742086 | Likelihood -32.812607 | KL fp 2.2457 | FP STD 0.1215|
KL coef: 0.39499393286246365
Train loss (one batch): 32.2829704284668
Train CE loss (one batch): 0.0
Test MSE (raw): 0.0073
Test MSE (smoothed with alpha=0.01): 0.0145
New best smoothed test MSE: 0.0145. Saving best model to experiments/experiment_39492_best.ckpt
Test MSE group_0: nan
Test MSE group_1: 0.0073
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: nan
train MSE group_1: 0.0073
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Experiment 39492
Epoch 0080 [Test seq (cond on sampled tp)] | Loss 19.913694 | Likelihood -19.857513 | KL fp 2.5719 | FP STD 0.0735|
KL coef: 0.505161340399793
Train loss (one batch): 19.80959129333496
Train CE loss (one batch): 0.0
Test MSE (raw): 0.0047
Test MSE (smoothed with alpha=0.01): 0.0144
New best smoothed test MSE: 0.0144. Saving best model to experiments/experiment_39492_best.ckpt
Test MSE group_0: nan
Test MSE group_1: 0.0047
Test MSE group_2: nan
Test MSE group_3: nan
Poisson likelihood: 0.0
CE loss: 0.0
train MSE group_0: nan
train MSE group_1: 0.0047
train MSE group_2: nan
train MSE group_3: nan
CE loss (TEST): 0.0
Couldn't import umap
Sampling dataset of 200 training examples
############## ['RE07D14', 'AN03M1', 'RE09M1', 'LM08M1', 'RE06D7', 'LM14M1', 'LM05M6', 'RE05M1', 'AN02M3', 'LM01M6', 'LM02M3', 'LM05M1', 'RE08M1', 'AN04D14', 'RE03M6', 'LM06M1', 'AN05M3', 'RE07M1', 'RE09M3', 'LM09D7', 'LM15M1', 'LM01D14', 'LM16D7', 'RE07M6', 'LM10M3', 'RE01D14', 'LM11M6', 'RE09D14']
137
TensorBoard logs will be saved to: experiments/runs/39492
Traceback (most recent call last):
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/run_models.py", line 288, in <module>
    train_res = model.compute_all_losses(batch_dict, n_traj_samples = 3, kl_coef = kl_coef)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/base_models.py", line 262, in compute_all_losses
    pred_y, info = self.get_reconstruction(batch_dict["tp_to_predict"], 
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/latent_ode.py", line 99, in get_reconstruction
    sol_y = self.diffeq_solver(first_point_enc_aug, time_steps_to_predict)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1747, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/benjaminmaurel/Documents/Training_Sanofi/notebooks_hands_on/latent_ode/lib/diffeq_solver.py", line 40, in forward
    pred_y = odeint(self.ode_func, first_point, time_steps_to_predict, 
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/odeint.py", line 80, in odeint
    solution = solver.integrate(t)
               ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/solvers.py", line 34, in integrate
    solution[i] = self._advance(t[i])
                  ^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 246, in _advance
    self.rk_state = self._adaptive_step(self.rk_state)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 311, in _adaptive_step
    y1, f1, y1_error, k = _runge_kutta_step(self.func, y0, f0, t0, dt, t1, tableau=self.tableau)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/miniconda3/envs/NODE_test/lib/python3.12/site-packages/torchdiffeq/_impl/rk_common.py", line 77, in _runge_kutta_step
    yi = y0 + torch.sum(k[..., :i + 1] * (beta_i * dt), dim=-1).view_as(f0)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
